<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TARA Analysis Tool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    
    <script type="module">
        import { Graphviz } from "https://cdn.jsdelivr.net/npm/@hpcc-js/wasm/dist/index.js";
        window.GraphvizLib = { Graphviz };
    </script>
</head>
<body>

    <div class="app-container">
        
        <div class="header-nav">
            <h1>TARA Tool</h1>
            <div class="action-nav">
                <button id="btnNewAnalysis" class="action-button small"><i class="fas fa-plus"></i> Neu</button>
                <select id="analysisSelector" style="width: 200px; padding:4px;">
                    </select>
            </div>
            <div class="utility-actions">
                <button id="btnImportAnalysis" class="action-button small"><i class="fas fa-file-import"></i> Import</button>
                <button id="btnExportAnalysis" class="action-button small"><i class="fas fa-file-export"></i> Export</button>
            </div>
        </div>

        <div class="main-content">
            
            <header class="main-header" style="padding: 10px 15px; margin-bottom: 10px;">
                <div style="width: 100%; display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <h2 id="analysisNameDisplay" style="margin:0; font-size:1.2em;">Analyse wählen oder neu starten</h2>
                        <div class="metadata" id="analysisMetadata" style="font-size:0.85em; color:#777; margin-top:2px;"></div>
                    </div>
                    <div class="header-actions">
                        <button id="btnSave" class="primary-button"><i class="fas fa-save"></i> Speichern</button>
                        <button id="btnShowVersionControl" class="action-button"><i class="fas fa-code-branch"></i> Versionen</button>
                        <button id="btnDeleteAnalysis" class="action-button dangerous"><i class="fas fa-trash"></i> Analyse löschen</button>
                    </div>
                </div>
            </header>

            <div class="tab-navigation">
                <button class="tab-button active" data-tab="tabOverview">Übersicht</button>
                <button class="tab-button" data-tab="tabAssets">Assets</button>
                <button class="tab-button" data-tab="tabDamageScenarios">Schadensszenarien</button>
                <button class="tab-button" data-tab="tabRiskAnalysis">Risikoanalyse</button>
                <button class="tab-button" data-tab="tabSecurityGoals">Security Ziele</button>
                <button class="tab-button" data-tab="tabResidualRisk">Restrisikoanalyse</button>
            </div>

            <div id="tabOverview" class="tab-content" style="display: block;">
                <div class="overview-actions" style="display:flex; justify-content:flex-end; margin-bottom:10px;">
                    <button id="btnGenerateReport" class="action-button"><i class="fas fa-file-pdf"></i> Report (PDF)</button>
                </div>

                <div class="dashboard-grid">
                    <div class="stats-row">
                        <div class="stat-card" style="border-left-color: #3498db;">
                            <span class="stat-label">Assets</span>
                            <span class="stat-value" id="statAssetCount">0</span>
                        </div>
                        <div class="stat-card" style="border-left-color: #e67e22;">
                            <span class="stat-label">Szenarien</span>
                            <span class="stat-value" id="statDSCount">0</span>
                        </div>
                        <div class="stat-card" style="border-left-color: #f1c40f;">
                            <span class="stat-label">Risiken (Gesamt)</span>
                            <span class="stat-value" id="statRiskCount">0</span>
                        </div>
                        <div class="stat-card" style="border-left-color: #e74c3c; display: block; padding: 10px 15px;">
                            <div style="font-size: 0.85em; color: #666; font-weight: 600; margin-bottom: 5px;">Risikoverteilung</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2px 10px; font-size: 0.85em;">
                                <div style="color:#c0392b; font-weight:bold;">Kritisch: <span id="statCrit" style="color:#333;">0</span></div>
                                <div style="color:#e67e22; font-weight:bold;">Hoch: <span id="statHigh" style="color:#333;">0</span></div>
                                <div style="color:#f39c12; font-weight:bold;">Mittel: <span id="statMed" style="color:#333;">0</span></div>
                                <div style="color:#27ae60; font-weight:bold;">Niedrig: <span id="statLow" style="color:#333;">0</span></div>
                            </div>
                        </div>

                        <div class="stat-card" style="border-left-color: #8e44ad; display: block; padding: 10px 15px;">
                            <div style="font-size: 0.85em; color: #666; font-weight: 600; margin-bottom: 5px;">Risikoverteilung Restrisiko</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2px 10px; font-size: 0.85em;">
                                <div style="color:#c0392b; font-weight:bold;">Kritisch: <span id="statRRCrit" style="color:#333;">0</span></div>
                                <div style="color:#e67e22; font-weight:bold;">Hoch: <span id="statRRHigh" style="color:#333;">0</span></div>
                                <div style="color:#f39c12; font-weight:bold;">Mittel: <span id="statRRMed" style="color:#333;">0</span></div>
                                <div style="color:#27ae60; font-weight:bold;">Niedrig: <span id="statRRLow" style="color:#333;">0</span></div>
                            </div>
                        </div>
                    </div>

                    <div class="panel" style="background: #fff; padding: 0;">
                        <h3 style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:10px;">Projektbeschreibung</h3>
                        <div class="meta-form-grid">
                            <div class="form-group">
                                <label>Analysename</label>
                                <input type="text" id="inputAnalysisName">
                            </div>
                            <div class="form-group">
                                <label>Autor / Verantwortlich</label>
                                <input type="text" id="inputAuthorName">
                            </div>
                            <div class="form-group">
                                <label>Systembeschreibung</label>
                                <textarea id="inputDescription" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Verwendungszweck (Intended Use)</label>
                                <textarea id="inputIntendedUse" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tabAssets" class="tab-content" style="display: none;">
                <div class="assets-controls" style="margin-bottom:15px;">
                    <button id="btnAddAsset" class="primary-button"><i class="fas fa-plus"></i> Asset hinzufügen</button>
                </div>
                <div id="assetsCardContainer" class="cards-grid"></div>
            </div>

            <div id="tabDamageScenarios" class="tab-content" style="display: none;">
                <div class="two-column-layout">
                    <div class="column-left" style="flex:1;">
                        <div class="panel">
                            <div class="panel-header" style="display:flex; justify-content:space-between;">
                                <h3 style="margin:0;">Verwaltung</h3>
                                <button id="btnAddDamageScenario" class="action-button small"><i class="fas fa-plus"></i> Neu</button>
                            </div>
                            <div id="dsManagementContainer" style="margin-top:10px;"></div>
                        </div>
                    </div>
                    <div class="column-right" style="flex:3;">
                        <div class="panel">
                            <h3 style="margin-top:0;">Schadensauswirkungsmatrix</h3>
                            <div id="dsMatrixContainer"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tabRiskAnalysis" class="tab-content" style="display: none;">
                <div class="panel">
                    <h3>Risikoanalyse & Angriffsbäume</h3>
                    <div id="riskAnalysisContainer"></div>
                </div>
            </div>

            <div id="tabSecurityGoals" class="tab-content" style="display: none;">
                <div class="assets-controls" style="margin-bottom:15px;">
                    <button id="btnAddSecurityGoal" class="primary-button"><i class="fas fa-plus"></i> Security Ziel hinzufügen</button>
                </div>
                <div id="securityGoalsScrollArea" class="scroll-area">
                    <div id="securityGoalsCardContainer" class="cards-grid"></div>
                </div>
            </div>

            <div id="tabResidualRisk" class="tab-content" style="display: none;">
                <div class="panel">
                    <h3>Restrisikoanalyse</h3>
                    <p style="color:#666; margin-top:0;">Erfassen Sie für jede Auswirkung eine Risikomaßnahme sowie Anmerkung und Security Maßnahme. Bei <b>Mitigiert</b> ist zusätzlich eine Neubewertung (K/S/T/U) erforderlich. Die Risikoanalyse bleibt dabei unverändert.</p>
                    <div id="residualRiskScrollArea" class="scroll-area">
                        <div id="residualRiskContainer"></div>
                    </div>
                </div>
            </div>

        
        <footer class="status-bar" style="background: #333; color: #fff; padding: 4px 20px; font-size: 0.8em; margin-top: auto;">
            <span id="statusBarMessage">Bereit.</span>
        </footer>
    </div>

    <div id="assetModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-button" id="closeAssetModal">&times;</span>
            <h2 id="assetModalTitle">Neues Asset</h2>
            <form id="assetForm">
                <input type="hidden" id="assetIdField">
                <div class="form-group">
                    <label>Name</label> <input type="text" id="assetName" required>
                </div>
                <div class="form-group">
                    <label>Typ</label> <input type="text" id="assetType">
                </div>
                <div class="form-group">
                    <label>Beschreibung</label> <textarea id="assetDescription" rows="3"></textarea>
                </div>
                <fieldset style="border:1px solid #ddd; padding:10px;">
                    <legend>Schutzbedarf (CIA)</legend>
                    <div class="cia-grid" style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px;">
                        <div>
                            <label>Confidentiality</label><br>
                            <label><input type="radio" name="confidentiality" value="I"> I</label>
                            <label><input type="radio" name="confidentiality" value="II"> II</label>
                            <label><input type="radio" name="confidentiality" value="III"> III</label>
                        </div>
                        <div>
                            <label>Integrity</label><br>
                            <label><input type="radio" name="integrity" value="I"> I</label>
                            <label><input type="radio" name="integrity" value="II"> II</label>
                            <label><input type="radio" name="integrity" value="III"> III</label>
                        </div>
                        <div>
                            <label>Availability</label><br>
                            <label><input type="radio" name="authenticity" value="I"> I</label>
                            <label><input type="radio" name="authenticity" value="II"> II</label>
                            <label><input type="radio" name="authenticity" value="III"> III</label>
                        </div>
                    </div>
                </fieldset>
                <button type="submit" class="primary-button" style="margin-top:15px;">Speichern</button>
            </form>
        </div>
    </div>

    <div id="damageScenarioModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-button" id="closeDamageScenarioModal">&times;</span>
            <h2 id="dsModalTitle">Schadensszenario</h2>
            <form id="damageScenarioForm">
                <input type="hidden" id="dsIdField">
                <div class="form-group"><label>Name</label><input type="text" id="dsName" required></div>
                <div class="form-group"><label>Kurzbeschreibung</label><input type="text" id="dsShort" required maxlength="10"></div>
                <div class="form-group"><label>Beschreibung</label><textarea id="dsDescription" rows="3"></textarea></div>
                <button type="submit" class="primary-button">Speichern</button>
            </form>
        </div>
    </div>

    <div id="securityGoalModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-button" id="closeSecurityGoalModal">&times;</span>
            <h2 id="securityGoalModalTitle">Security Ziel</h2>
            <form id="securityGoalForm">
                <input type="hidden" id="sgIdField">
                <div class="form-group"><label>Name</label><input type="text" id="sgName" required></div>
                <div class="form-group"><label>Beschreibung</label><textarea id="sgDescription" rows="4"></textarea></div>
                <div class="form-group">
                    <label>Referenzierte Angriffsziel(e) (Root)</label>
                    <select id="sgRootRefs" multiple size="6" style="width:100%;"></select>
                    <div style="font-size:0.8em; color:#777; margin-top:4px;">Mehrfachauswahl: Strg/⌘</div>
                </div>
                <button type="submit" class="primary-button">Speichern</button>
            </form>
        </div>
    </div>

    <div id="attackTreeModal" class="modal large-modal" style="display: none;">
        <div class="modal-content large-content">
            <span class="close-button" id="closeAttackTreeModal">&times;</span>
            
            <form id="attackTreeForm">
                <input type="hidden" id="at_id" name="at_id">
                <input type="hidden" id="use_deep_tree" name="use_deep_tree" value="false">
                <input type="hidden" id="tree_depth" name="tree_depth" value="1">
                <input type="hidden" id="use_second_intermediate" name="use_second_intermediate" value="false">

                <div style="background:#f0f0f0; padding:10px; border-radius:4px; border:1px solid #ccc; margin-bottom:15px; display:flex; gap:15px; align-items:center;">
                    <strong style="white-space:nowrap;">Angriffsziel (Root):</strong>
                    <input type="text" name="at_root" placeholder="z.B. Manipulation der Firmware" required style="flex-grow:1; font-weight:bold;">
                    <div id="at_root_kstu_summary" class="node-stats-box" style="width:200px; margin-top:0;"></div>
                </div>

                <div class="tree-controls" style="margin-bottom:10px;">
                    <button type="button" id="btnToggleTreeDepth" class="action-button small"><i class="fas fa-layer-group"></i> Zwischenebene einblenden</button>
                    <button type="button" id="btnToggleTreeDepth2" class="action-button small" style="display:none; margin-left:10px;"><i class="fas fa-layer-group"></i> 2. Zwischenpfad anlegen</button>
                </div>

                <div class="tree-structure-table">
                    <table>
                        <thead>
                            <tr>
                                <th style="width:30%;">Angriffspfad</th>
                                <th class="col-level-2" style="display:none; width:20%;">Angriffspfad</th>
                                <th class="col-level-3" style="display:none; width:20%;">Angriffspfad</th>
                                <th>Auswirkung</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="branch-separator"><td colspan="4"><strong>Pfad 1</strong></td></tr>
                            <tr class="impact-row" data-branch="1" data-impact="1">
                                <td rowspan="2" class="cell-l1" id="at_branch_1_cell_l1">
                                    <div class="form-group">
                                        <input type="text" name="at_branch_1" placeholder="Name Pfad 1">
                                    </div>
                                    <div id="at_branch_1_kstu_summary" class="node-stats-box"></div>
                                    <div style="text-align:right; margin-top:6px;">
                                        <button type="button" class="action-button small remove-impact-btn level-l1" data-branch="1" title="Auswirkung entfernen" aria-label="Auswirkung entfernen" style="margin-right:4px;"><i class="fas fa-minus"></i></button>
                                        <button type="button" class="action-button small add-impact-btn level-l1" data-branch="1" title="Auswirkung hinzufügen" aria-label="Auswirkung hinzufügen"><i class="fas fa-plus"></i></button>
                                    </div>
                                </td>
                                <td rowspan="2" class="cell-l2 col-level-2" style="display:none;" id="at_branch_1_cell_l2">
                                    <div class="form-group"><input type="text" name="at_branch_1_l2" placeholder="Zwischenknoten"></div>
                                    <div id="at_branch_1_l2_kstu_summary" class="node-stats-box"></div>
                                    <div style="text-align:right; margin-top:6px;">
                                        <button type="button" class="action-button small remove-impact-btn level-l2" data-branch="1" title="Auswirkung entfernen" aria-label="Auswirkung entfernen" style="margin-right:4px;"><i class="fas fa-minus"></i></button>
                                        <button type="button" class="action-button small add-impact-btn level-l2" data-branch="1" title="Auswirkung hinzufügen" aria-label="Auswirkung hinzufügen"><i class="fas fa-plus"></i></button>
                                    </div>
                                </td>
                                <td rowspan="2" class="cell-l3 col-level-3" style="display:none;" id="at_branch_1_cell_l3">
                                    <div class="form-group"><input type="text" name="at_branch_1_l3" placeholder="Zwischenknoten 2"></div>
                                    <div id="at_branch_1_l3_kstu_summary" class="node-stats-box"></div>
                                    <div style="text-align:right; margin-top:6px;">
                                        <button type="button" class="action-button small add-impact-btn level-l3" data-branch="1" title="Auswirkung hinzufügen" aria-label="Auswirkung hinzufügen"><i class="fas fa-plus"></i></button>
                                    </div>
                                </td>
                                <td class="cell-leaf">
                                    <div class="leaf-container">
                                        <input type="text" name="at_leaf_1_text" placeholder="Schritt 1.1">
                                        <div class="ds-checks">
                                            <span>Impact:</span>
                                            <label>DS1<input type="checkbox" name="at_leaf_1_ds1"></label>
                                            <label>DS2<input type="checkbox" name="at_leaf_1_ds2"></label>
                                            <label>DS3<input type="checkbox" name="at_leaf_1_ds3"></label>
                                            <label>DS4<input type="checkbox" name="at_leaf_1_ds4"></label>
                                            <label>DS5<input type="checkbox" name="at_leaf_1_ds5"></label>
                                        </div>
                                        <div class="kstu-grid">
                                            <select name="at_leaf_1_k" class="kstu-select"></select>
                                            <select name="at_leaf_1_s" class="kstu-select"></select>
                                            <select name="at_leaf_1_t" class="kstu-select"></select>
                                            <select name="at_leaf_1_u" class="kstu-select"></select>
                                        </div>
                                        <input type="hidden" name="at_leaf_1_i">
                                        <div id="at_leaf_1_summary" class="node-stats-box"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="impact-row" data-branch="1" data-impact="2">
                                <td class="cell-leaf">
                                    <div class="leaf-container">
                                        <input type="text" name="at_leaf_2_text" placeholder="Schritt 1.2">
                                        <div class="ds-checks">
                                            <span>Impact:</span>
                                            <label>DS1<input type="checkbox" name="at_leaf_2_ds1"></label>
                                            <label>DS2<input type="checkbox" name="at_leaf_2_ds2"></label>
                                            <label>DS3<input type="checkbox" name="at_leaf_2_ds3"></label>
                                            <label>DS4<input type="checkbox" name="at_leaf_2_ds4"></label>
                                            <label>DS5<input type="checkbox" name="at_leaf_2_ds5"></label>
                                        </div>
                                        <div class="kstu-grid">
                                            <select name="at_leaf_2_k" class="kstu-select"></select>
                                            <select name="at_leaf_2_s" class="kstu-select"></select>
                                            <select name="at_leaf_2_t" class="kstu-select"></select>
                                            <select name="at_leaf_2_u" class="kstu-select"></select>
                                        </div>
                                        <input type="hidden" name="at_leaf_2_i">
                                        <div id="at_leaf_2_summary" class="node-stats-box"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="impact-row extra-impact" data-branch="1" data-impact="3" style="display:none;">
                                <td class="cell-leaf">
                                    <div class="leaf-container">
                                        <input type="text" name="at_leaf_3_text" placeholder="Schritt 1.3">
                                        <div class="ds-checks">
                                            <span>Impact:</span>
                                            <label>DS1<input type="checkbox" name="at_leaf_3_ds1"></label>
                                            <label>DS2<input type="checkbox" name="at_leaf_3_ds2"></label>
                                            <label>DS3<input type="checkbox" name="at_leaf_3_ds3"></label>
                                            <label>DS4<input type="checkbox" name="at_leaf_3_ds4"></label>
                                            <label>DS5<input type="checkbox" name="at_leaf_3_ds5"></label>
                                        </div>
                                        <div class="kstu-grid">
                                            <select name="at_leaf_3_k" class="kstu-select"></select>
                                            <select name="at_leaf_3_s" class="kstu-select"></select>
                                            <select name="at_leaf_3_t" class="kstu-select"></select>
                                            <select name="at_leaf_3_u" class="kstu-select"></select>
                                        </div>
                                        <input type="hidden" name="at_leaf_3_i">
                                        <div id="at_leaf_3_summary" class="node-stats-box"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="impact-row extra-impact" data-branch="1" data-impact="4" style="display:none;">
                                <td class="cell-leaf">
                                    <div class="leaf-container">
                                        <input type="text" name="at_leaf_4_text" placeholder="Schritt 1.4">
                                        <div class="ds-checks">
                                            <span>Impact:</span>
                                            <label>DS1<input type="checkbox" name="at_leaf_4_ds1"></label>
                                            <label>DS2<input type="checkbox" name="at_leaf_4_ds2"></label>
                                            <label>DS3<input type="checkbox" name="at_leaf_4_ds3"></label>
                                            <label>DS4<input type="checkbox" name="at_leaf_4_ds4"></label>
                                            <label>DS5<input type="checkbox" name="at_leaf_4_ds5"></label>
                                        </div>
                                        <div class="kstu-grid">
                                            <select name="at_leaf_4_k" class="kstu-select"></select>
                                            <select name="at_leaf_4_s" class="kstu-select"></select>
                                            <select name="at_leaf_4_t" class="kstu-select"></select>
                                            <select name="at_leaf_4_u" class="kstu-select"></select>
                                        </div>
                                        <input type="hidden" name="at_leaf_4_i">
                                        <div id="at_leaf_4_summary" class="node-stats-box"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="impact-row extra-impact" data-branch="1" data-impact="5" style="display:none;">
                                <td class="cell-leaf">
                                    <div class="leaf-container">
                                        <input type="text" name="at_leaf_5_text" placeholder="Schritt 1.5">
                                        <div class="ds-checks">
                                            <span>Impact:</span>
                                            <label>DS1<input type="checkbox" name="at_leaf_5_ds1"></label>
                                            <label>DS2<input type="checkbox" name="at_leaf_5_ds2"></label>
                                            <label>DS3<input type="checkbox" name="at_leaf_5_ds3"></label>
                                            <label>DS4<input type="checkbox" name="at_leaf_5_ds4"></label>
                                            <label>DS5<input type="checkbox" name="at_leaf_5_ds5"></label>
                                        </div>
                                        <div class="kstu-grid">
                                            <select name="at_leaf_5_k" class="kstu-select"></select>
                                            <select name="at_leaf_5_s" class="kstu-select"></select>
                                            <select name="at_leaf_5_t" class="kstu-select"></select>
                                            <select name="at_leaf_5_u" class="kstu-select"></select>
                                        </div>
                                        <input type="hidden" name="at_leaf_5_i">
                                        <div id="at_leaf_5_summary" class="node-stats-box"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="impact-row l2b-row" data-branch="1" data-group="b" data-impact="1" style="display:none;">
                                <td rowspan="2" class="cell-l2 col-level-2" style="display:none;" id="at_branch_1_cell_l2b">
                                    <div class="form-group"><input type="text" name="at_branch_1_l2b" placeholder="Zwischenknoten 2"></div>
                                    <div id="at_branch_1_l2b_kstu_summary" class="node-stats-box"></div>
                                    <div style="text-align:right; margin-top:6px;">
                                        <button type="button" class="action-button small remove-impact-btn level-l2b" data-branch="1" data-group="b" title="Auswirkung entfernen" aria-label="Auswirkung entfernen" style="margin-right:4px;"><i class="fas fa-minus"></i></button>
                                        <button type="button" class="action-button small add-impact-btn level-l2b" data-branch="1" data-group="b" title="Auswirkung hinzufügen" aria-label="Auswirkung hinzufügen"><i class="fas fa-plus"></i></button>
                                    </div>
                                </td>
                                <td class="cell-leaf">
                                    <div class="leaf-container">
                                        <input type="text" name="at_leaf_11_text" placeholder="Schritt 1.1">
                                        <div class="ds-checks">
                                            <span>Impact:</span>
                                            <label>DS1<input type="checkbox" name="at_leaf_11_ds1"></label>
                                            <label>DS2<input type="checkbox" name="at_leaf_11_ds2"></label>
                                            <label>DS3<input type="checkbox" name="at_leaf_11_ds3"></label>
                                            <label>DS4<input type="checkbox" name="at_leaf_11_ds4"></label>
                                            <label>DS5<input type="checkbox" name="at_leaf_11_ds5"></label>
                                        </div>
                                        <div class="kstu-grid">
                                            <select name="at_leaf_11_k" class="kstu-select"></select>
                                            <select name="at_leaf_11_s" class="kstu-select"></select>
                                            <select name="at_leaf_11_t" class="kstu-select"></select>
                                            <select name="at_leaf_11_u" class="kstu-select"></select>
                                        </div>
                                        <input type="hidden" name="at_leaf_11_i">
                                        <div id="at_leaf_11_summary" class="node-stats-box"></div>
                                    </div>
                                </td>
                            </tr>

                            <tr class="impact-row l2b-row" data-branch="1" data-group="b" data-impact="2" style="display:none;">
                                <td class="cell-leaf">
                                    <div class="leaf-container">
                                        <input type="text" name="at_leaf_12_text" placeholder="Schritt 1.2">
                                        <div class="ds-checks">
                                            <span>Impact:</span>
                                            <label>DS1<input type="checkbox" name="at_leaf_12_ds1"></label>
                                            <label>DS2<input type="checkbox" name="at_leaf_12_ds2"></label>
                                            <label>DS3<input type="checkbox" name="at_leaf_12_ds3"></label>
                                            <label>DS4<input type="checkbox" name="at_leaf_12_ds4"></label>
                                            <label>DS5<input type="checkbox" name="at_leaf_12_ds5"></label>
                                        </div>
                                        <div class="kstu-grid">
                                            <select name="at_leaf_12_k" class="kstu-select"></select>
                                            <select name="at_leaf_12_s" class="kstu-select"></select>
                                            <select name="at_leaf_12_t" class="kstu-select"></select>
                                            <select name="at_leaf_12_u" class="kstu-select"></select>
                                        </div>
                                        <input type="hidden" name="at_leaf_12_i">
                                        <div id="at_leaf_12_summary" class="node-stats-box"></div>
                                    </div>
                                </td>
                            </tr>

                            <tr class="impact-row extra-impact l2b-row" data-branch="1" data-group="b" data-impact="3" style="display:none;">
                                <td class="cell-leaf">
                                    <div class="leaf-container">
                                        <input type="text" name="at_leaf_13_text" placeholder="Schritt 1.3">
                                        <div class="ds-checks">
                                            <span>Impact:</span>
                                            <label>DS1<input type="checkbox" name="at_leaf_13_ds1"></label>
                                            <label>DS2<input type="checkbox" name="at_leaf_13_ds2"></label>
                                            <label>DS3<input type="checkbox" name="at_leaf_13_ds3"></label>
                                            <label>DS4<input type="checkbox" name="at_leaf_13_ds4"></label>
                                            <label>DS5<input type="checkbox" name="at_leaf_13_ds5"></label>
                                        </div>
                                        <div class="kstu-grid">
                                            <select name="at_leaf_13_k" class="kstu-select"></select>
                                            <select name="at_leaf_13_s" class="kstu-select"></select>
                                            <select name="at_leaf_13_t" class="kstu-select"></select>
                                            <select name="at_leaf_13_u" class="kstu-select"></select>
                                        </div>
                                        <input type="hidden" name="at_leaf_13_i">
                                        <div id="at_leaf_13_summary" class="node-stats-box"></div>
                                    </div>
                                </td>
                            </tr>

                            <tr class="impact-row extra-impact l2b-row" data-branch="1" data-group="b" data-impact="4" style="display:none;">
                                <td class="cell-leaf">
                                    <div class="leaf-container">
                                        <input type="text" name="at_leaf_14_text" placeholder="Schritt 1.4">
                                        <div class="ds-checks">
                                            <span>Impact:</span>
                                            <label>DS1<input type="checkbox" name="at_leaf_14_ds1"></label>
                                            <label>DS2<input type="checkbox" name="at_leaf_14_ds2"></label>
                                            <label>DS3<input type="checkbox" name="at_leaf_14_ds3"></label>
                                            <label>DS4<input type="checkbox" name="at_leaf_14_ds4"></label>
                                            <label>DS5<input type="checkbox" name="at_leaf_14_ds5"></label>
                                        </div>
                                        <div class="kstu-grid">
                                            <select name="at_leaf_14_k" class="kstu-select"></select>
                                            <select name="at_leaf_14_s" class="kstu-select"></select>
                                            <select name="at_leaf_14_t" class="kstu-select"></select>
                                            <select name="at_leaf_14_u" class="kstu-select"></select>
                                        </div>
                                        <input type="hidden" name="at_leaf_14_i">
                                        <div id="at_leaf_14_summary" class="node-stats-box"></div>
                                    </div>
                                </td>
                            </tr>

                            <tr class="impact-row extra-impact l2b-row" data-branch="1" data-group="b" data-impact="5" style="display:none;">
                                <td class="cell-leaf">
                                    <div class="leaf-container">
                                        <input type="text" name="at_leaf_15_text" placeholder="Schritt 1.5">
                                        <div class="ds-checks">
                                            <span>Impact:</span>
                                            <label>DS1<input type="checkbox" name="at_leaf_15_ds1"></label>
                                            <label>DS2<input type="checkbox" name="at_leaf_15_ds2"></label>
                                            <label>DS3<input type="checkbox" name="at_leaf_15_ds3"></label>
                                            <label>DS4<input type="checkbox" name="at_leaf_15_ds4"></label>
                                            <label>DS5<input type="checkbox" name="at_leaf_15_ds5"></label>
                                        </div>
                                        <div class="kstu-grid">
                                            <select name="at_leaf_15_k" class="kstu-select"></select>
                                            <select name="at_leaf_15_s" class="kstu-select"></select>
                                            <select name="at_leaf_15_t" class="kstu-select"></select>
                                            <select name="at_leaf_15_u" class="kstu-select"></select>
                                        </div>
                                        <input type="hidden" name="at_leaf_15_i">
                                        <div id="at_leaf_15_summary" class="node-stats-box"></div>
                                    </div>
                                </td>
                            </tr>

                            <tr class="branch-separator"><td colspan="4"><strong>Pfad 2</strong></td></tr>
                            <tr class="impact-row" data-branch="2" data-impact="1">
                                <td rowspan="2" class="cell-l1" id="at_branch_2_cell_l1">
                                    <div class="form-group"><input type="text" name="at_branch_2" placeholder="Name Pfad 2"></div>
                                    <div id="at_branch_2_kstu_summary" class="node-stats-box"></div>
                                    <div style="text-align:right; margin-top:6px;">
                                        <button type="button" class="action-button small remove-impact-btn level-l1" data-branch="2" title="Auswirkung entfernen" aria-label="Auswirkung entfernen" style="margin-right:4px;"><i class="fas fa-minus"></i></button>
                                        <button type="button" class="action-button small add-impact-btn level-l1" data-branch="2" title="Auswirkung hinzufügen" aria-label="Auswirkung hinzufügen"><i class="fas fa-plus"></i></button>
                                    </div>
                                </td>
                                <td rowspan="2" class="cell-l2 col-level-2" style="display:none;" id="at_branch_2_cell_l2">
                                    <div class="form-group"><input type="text" name="at_branch_2_l2" placeholder="Zwischenknoten"></div>
                                    <div id="at_branch_2_l2_kstu_summary" class="node-stats-box"></div>
                                    <div style="text-align:right; margin-top:6px;">
                                        <button type="button" class="action-button small remove-impact-btn level-l2" data-branch="2" title="Auswirkung entfernen" aria-label="Auswirkung entfernen" style="margin-right:4px;"><i class="fas fa-minus"></i></button>
                                        <button type="button" class="action-button small add-impact-btn level-l2" data-branch="2" title="Auswirkung hinzufügen" aria-label="Auswirkung hinzufügen"><i class="fas fa-plus"></i></button>
                                    </div>
                                </td>
                                <td rowspan="2" class="cell-l3 col-level-3" style="display:none;" id="at_branch_2_cell_l3">
                                    <div class="form-group"><input type="text" name="at_branch_2_l3" placeholder="Zwischenknoten 2"></div>
                                    <div id="at_branch_2_l3_kstu_summary" class="node-stats-box"></div>
                                    <div style="text-align:right; margin-top:6px;">
                                        <button type="button" class="action-button small add-impact-btn level-l3" data-branch="2" title="Auswirkung hinzufügen" aria-label="Auswirkung hinzufügen"><i class="fas fa-plus"></i></button>
                                    </div>
                                </td>
                                <td class="cell-leaf">
                                    <div class="leaf-container">
                                        <input type="text" name="at_leaf_6_text" placeholder="Schritt 2.1">
                                        <div class="ds-checks">
                                            <span>Impact:</span>
                                            <label>DS1<input type="checkbox" name="at_leaf_6_ds1"></label>
                                            <label>DS2<input type="checkbox" name="at_leaf_6_ds2"></label>
                                            <label>DS3<input type="checkbox" name="at_leaf_6_ds3"></label>
                                            <label>DS4<input type="checkbox" name="at_leaf_6_ds4"></label>
                                            <label>DS5<input type="checkbox" name="at_leaf_6_ds5"></label>
                                        </div>
                                        <div class="kstu-grid">
                                            <select name="at_leaf_6_k" class="kstu-select"></select>
                                            <select name="at_leaf_6_s" class="kstu-select"></select>
                                            <select name="at_leaf_6_t" class="kstu-select"></select>
                                            <select name="at_leaf_6_u" class="kstu-select"></select>
                                        </div>
                                        <input type="hidden" name="at_leaf_6_i">
                                        <div id="at_leaf_6_summary" class="node-stats-box"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="impact-row" data-branch="2" data-impact="2">
                                <td class="cell-leaf">
                                    <div class="leaf-container">
                                        <input type="text" name="at_leaf_7_text" placeholder="Schritt 2.2">
                                        <div class="ds-checks">
                                            <span>Impact:</span>
                                            <label>DS1<input type="checkbox" name="at_leaf_7_ds1"></label>
                                            <label>DS2<input type="checkbox" name="at_leaf_7_ds2"></label>
                                            <label>DS3<input type="checkbox" name="at_leaf_7_ds3"></label>
                                            <label>DS4<input type="checkbox" name="at_leaf_7_ds4"></label>
                                            <label>DS5<input type="checkbox" name="at_leaf_7_ds5"></label>
                                        </div>
                                        <div class="kstu-grid">
                                            <select name="at_leaf_7_k" class="kstu-select"></select>
                                            <select name="at_leaf_7_s" class="kstu-select"></select>
                                            <select name="at_leaf_7_t" class="kstu-select"></select>
                                            <select name="at_leaf_7_u" class="kstu-select"></select>
                                        </div>
                                        <input type="hidden" name="at_leaf_7_i">
                                        <div id="at_leaf_7_summary" class="node-stats-box"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="impact-row extra-impact" data-branch="2" data-impact="3" style="display:none;">
                                <td class="cell-leaf">
                                    <div class="leaf-container">
                                        <input type="text" name="at_leaf_8_text" placeholder="Schritt 2.3">
                                        <div class="ds-checks">
                                            <span>Impact:</span>
                                            <label>DS1<input type="checkbox" name="at_leaf_8_ds1"></label>
                                            <label>DS2<input type="checkbox" name="at_leaf_8_ds2"></label>
                                            <label>DS3<input type="checkbox" name="at_leaf_8_ds3"></label>
                                            <label>DS4<input type="checkbox" name="at_leaf_8_ds4"></label>
                                            <label>DS5<input type="checkbox" name="at_leaf_8_ds5"></label>
                                        </div>
                                        <div class="kstu-grid">
                                            <select name="at_leaf_8_k" class="kstu-select"></select>
                                            <select name="at_leaf_8_s" class="kstu-select"></select>
                                            <select name="at_leaf_8_t" class="kstu-select"></select>
                                            <select name="at_leaf_8_u" class="kstu-select"></select>
                                        </div>
                                        <input type="hidden" name="at_leaf_8_i">
                                        <div id="at_leaf_8_summary" class="node-stats-box"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="impact-row extra-impact" data-branch="2" data-impact="4" style="display:none;">
                                <td class="cell-leaf">
                                    <div class="leaf-container">
                                        <input type="text" name="at_leaf_9_text" placeholder="Schritt 2.4">
                                        <div class="ds-checks">
                                            <span>Impact:</span>
                                            <label>DS1<input type="checkbox" name="at_leaf_9_ds1"></label>
                                            <label>DS2<input type="checkbox" name="at_leaf_9_ds2"></label>
                                            <label>DS3<input type="checkbox" name="at_leaf_9_ds3"></label>
                                            <label>DS4<input type="checkbox" name="at_leaf_9_ds4"></label>
                                            <label>DS5<input type="checkbox" name="at_leaf_9_ds5"></label>
                                        </div>
                                        <div class="kstu-grid">
                                            <select name="at_leaf_9_k" class="kstu-select"></select>
                                            <select name="at_leaf_9_s" class="kstu-select"></select>
                                            <select name="at_leaf_9_t" class="kstu-select"></select>
                                            <select name="at_leaf_9_u" class="kstu-select"></select>
                                        </div>
                                        <input type="hidden" name="at_leaf_9_i">
                                        <div id="at_leaf_9_summary" class="node-stats-box"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="impact-row extra-impact" data-branch="2" data-impact="5" style="display:none;">
                                <td class="cell-leaf">
                                    <div class="leaf-container">
                                        <input type="text" name="at_leaf_10_text" placeholder="Schritt 2.5">
                                        <div class="ds-checks">
                                            <span>Impact:</span>
                                            <label>DS1<input type="checkbox" name="at_leaf_10_ds1"></label>
                                            <label>DS2<input type="checkbox" name="at_leaf_10_ds2"></label>
                                            <label>DS3<input type="checkbox" name="at_leaf_10_ds3"></label>
                                            <label>DS4<input type="checkbox" name="at_leaf_10_ds4"></label>
                                            <label>DS5<input type="checkbox" name="at_leaf_10_ds5"></label>
                                        </div>
                                        <div class="kstu-grid">
                                            <select name="at_leaf_10_k" class="kstu-select"></select>
                                            <select name="at_leaf_10_s" class="kstu-select"></select>
                                            <select name="at_leaf_10_t" class="kstu-select"></select>
                                            <select name="at_leaf_10_u" class="kstu-select"></select>
                                        </div>
                                        <input type="hidden" name="at_leaf_10_i">
                                        <div id="at_leaf_10_summary" class="node-stats-box"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="impact-row l2b-row" data-branch="2" data-group="b" data-impact="1" style="display:none;">
                                <td rowspan="2" class="cell-l2 col-level-2" style="display:none;" id="at_branch_2_cell_l2b">
                                    <div class="form-group"><input type="text" name="at_branch_2_l2b" placeholder="Zwischenknoten 2"></div>
                                    <div id="at_branch_2_l2b_kstu_summary" class="node-stats-box"></div>
                                    <div style="text-align:right; margin-top:6px;">
                                        <button type="button" class="action-button small remove-impact-btn level-l2b" data-branch="2" data-group="b" title="Auswirkung entfernen" aria-label="Auswirkung entfernen" style="margin-right:4px;"><i class="fas fa-minus"></i></button>
                                        <button type="button" class="action-button small add-impact-btn level-l2b" data-branch="2" data-group="b" title="Auswirkung hinzufügen" aria-label="Auswirkung hinzufügen"><i class="fas fa-plus"></i></button>
                                    </div>
                                </td>
                                <td class="cell-leaf">
                                    <div class="leaf-container">
                                        <input type="text" name="at_leaf_16_text" placeholder="Schritt 2.1">
                                        <div class="ds-checks">
                                            <span>Impact:</span>
                                            <label>DS1<input type="checkbox" name="at_leaf_16_ds1"></label>
                                            <label>DS2<input type="checkbox" name="at_leaf_16_ds2"></label>
                                            <label>DS3<input type="checkbox" name="at_leaf_16_ds3"></label>
                                            <label>DS4<input type="checkbox" name="at_leaf_16_ds4"></label>
                                            <label>DS5<input type="checkbox" name="at_leaf_16_ds5"></label>
                                        </div>
                                        <div class="kstu-grid">
                                            <select name="at_leaf_16_k" class="kstu-select"></select>
                                            <select name="at_leaf_16_s" class="kstu-select"></select>
                                            <select name="at_leaf_16_t" class="kstu-select"></select>
                                            <select name="at_leaf_16_u" class="kstu-select"></select>
                                        </div>
                                        <input type="hidden" name="at_leaf_16_i">
                                        <div id="at_leaf_16_summary" class="node-stats-box"></div>
                                    </div>
                                </td>
                            </tr>

                            <tr class="impact-row l2b-row" data-branch="2" data-group="b" data-impact="2" style="display:none;">
                                <td class="cell-leaf">
                                    <div class="leaf-container">
                                        <input type="text" name="at_leaf_17_text" placeholder="Schritt 2.2">
                                        <div class="ds-checks">
                                            <span>Impact:</span>
                                            <label>DS1<input type="checkbox" name="at_leaf_17_ds1"></label>
                                            <label>DS2<input type="checkbox" name="at_leaf_17_ds2"></label>
                                            <label>DS3<input type="checkbox" name="at_leaf_17_ds3"></label>
                                            <label>DS4<input type="checkbox" name="at_leaf_17_ds4"></label>
                                            <label>DS5<input type="checkbox" name="at_leaf_17_ds5"></label>
                                        </div>
                                        <div class="kstu-grid">
                                            <select name="at_leaf_17_k" class="kstu-select"></select>
                                            <select name="at_leaf_17_s" class="kstu-select"></select>
                                            <select name="at_leaf_17_t" class="kstu-select"></select>
                                            <select name="at_leaf_17_u" class="kstu-select"></select>
                                        </div>
                                        <input type="hidden" name="at_leaf_17_i">
                                        <div id="at_leaf_17_summary" class="node-stats-box"></div>
                                    </div>
                                </td>
                            </tr>

                            <tr class="impact-row extra-impact l2b-row" data-branch="2" data-group="b" data-impact="3" style="display:none;">
                                <td class="cell-leaf">
                                    <div class="leaf-container">
                                        <input type="text" name="at_leaf_18_text" placeholder="Schritt 2.3">
                                        <div class="ds-checks">
                                            <span>Impact:</span>
                                            <label>DS1<input type="checkbox" name="at_leaf_18_ds1"></label>
                                            <label>DS2<input type="checkbox" name="at_leaf_18_ds2"></label>
                                            <label>DS3<input type="checkbox" name="at_leaf_18_ds3"></label>
                                            <label>DS4<input type="checkbox" name="at_leaf_18_ds4"></label>
                                            <label>DS5<input type="checkbox" name="at_leaf_18_ds5"></label>
                                        </div>
                                        <div class="kstu-grid">
                                            <select name="at_leaf_18_k" class="kstu-select"></select>
                                            <select name="at_leaf_18_s" class="kstu-select"></select>
                                            <select name="at_leaf_18_t" class="kstu-select"></select>
                                            <select name="at_leaf_18_u" class="kstu-select"></select>
                                        </div>
                                        <input type="hidden" name="at_leaf_18_i">
                                        <div id="at_leaf_18_summary" class="node-stats-box"></div>
                                    </div>
                                </td>
                            </tr>

                            <tr class="impact-row extra-impact l2b-row" data-branch="2" data-group="b" data-impact="4" style="display:none;">
                                <td class="cell-leaf">
                                    <div class="leaf-container">
                                        <input type="text" name="at_leaf_19_text" placeholder="Schritt 2.4">
                                        <div class="ds-checks">
                                            <span>Impact:</span>
                                            <label>DS1<input type="checkbox" name="at_leaf_19_ds1"></label>
                                            <label>DS2<input type="checkbox" name="at_leaf_19_ds2"></label>
                                            <label>DS3<input type="checkbox" name="at_leaf_19_ds3"></label>
                                            <label>DS4<input type="checkbox" name="at_leaf_19_ds4"></label>
                                            <label>DS5<input type="checkbox" name="at_leaf_19_ds5"></label>
                                        </div>
                                        <div class="kstu-grid">
                                            <select name="at_leaf_19_k" class="kstu-select"></select>
                                            <select name="at_leaf_19_s" class="kstu-select"></select>
                                            <select name="at_leaf_19_t" class="kstu-select"></select>
                                            <select name="at_leaf_19_u" class="kstu-select"></select>
                                        </div>
                                        <input type="hidden" name="at_leaf_19_i">
                                        <div id="at_leaf_19_summary" class="node-stats-box"></div>
                                    </div>
                                </td>
                            </tr>

                            <tr class="impact-row extra-impact l2b-row" data-branch="2" data-group="b" data-impact="5" style="display:none;">
                                <td class="cell-leaf">
                                    <div class="leaf-container">
                                        <input type="text" name="at_leaf_20_text" placeholder="Schritt 2.5">
                                        <div class="ds-checks">
                                            <span>Impact:</span>
                                            <label>DS1<input type="checkbox" name="at_leaf_20_ds1"></label>
                                            <label>DS2<input type="checkbox" name="at_leaf_20_ds2"></label>
                                            <label>DS3<input type="checkbox" name="at_leaf_20_ds3"></label>
                                            <label>DS4<input type="checkbox" name="at_leaf_20_ds4"></label>
                                            <label>DS5<input type="checkbox" name="at_leaf_20_ds5"></label>
                                        </div>
                                        <div class="kstu-grid">
                                            <select name="at_leaf_20_k" class="kstu-select"></select>
                                            <select name="at_leaf_20_s" class="kstu-select"></select>
                                            <select name="at_leaf_20_t" class="kstu-select"></select>
                                            <select name="at_leaf_20_u" class="kstu-select"></select>
                                        </div>
                                        <input type="hidden" name="at_leaf_20_i">
                                        <div id="at_leaf_20_summary" class="node-stats-box"></div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="modal-actions" style="margin-top: 20px; display:flex; justify-content:space-between;">
                     <button type="button" id="btnDeleteAttackTree" class="action-button dangerous" style="display:none;">Löschen</button>
                     <button type="submit" class="primary-button large">Speichern & Schließen</button>
                </div>
            </form>
            
            <div style="margin-top: 30px; border-top: 1px solid #ddd; padding-top: 15px;">
                <h4 style="margin:0 0 10px 0;">Vorschau</h4>
                <button type="button" onclick="renderCurrentTreePreview()" class="action-button small">
                    <i class="fas fa-eye"></i> Generieren
                </button>
                <div id="graph-preview-container" style="margin-top: 10px; overflow: auto; max-height: 400px; border: 1px solid #eee;"></div>
            </div>
        </div>
    </div>

    <div id="newAnalysisModal" class="modal" style="display:none;">
        <div class="modal-content"><span class="close-button" id="closeNewAnalysisModal">&times;</span>
        <h2>Neue Analyse</h2>
        <form id="newAnalysisForm">
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="newAnalysisName" required>
            </div>

            <div class="form-group" style="display:flex; gap:10px; align-items:center;">
                <button type="button" id="btnToggleCopyExistingAnalysis" class="action-button small">Kopieren</button>
            </div>

            <div class="form-group" id="copyExistingAnalysisGroup" style="display:none;">
                <label>Vorlage</label>
                <select id="copyExistingAnalysisSelect"></select>
            </div>

            <button type="submit" class="primary-button">Erstellen</button>
        </form>
        </div>
    </div>
    <div id="importAnalysisModal" class="modal" style="display:none;">
        <div class="modal-content"><span class="close-button" id="closeImportAnalysisModal">&times;</span><h2>Import</h2><input type="file" id="importFileInput" accept=".json"><div style="margin-top:10px;"><button class="primary-button" onclick="executeImport()">Importieren</button></div></div>
    </div>
    

    <!-- Restrisikoanalyse Modal (Bearbeiten) -->
    <div id="residualRiskModal" class="modal large-modal" style="display:none;">
        <div class="modal-content">
            <span class="close-button" id="closeResidualRiskModal">&times;</span>
            <h2 id="residualRiskModalTitle">Restrisiko bearbeiten</h2>
            <div id="residualRiskModalBody"></div>
            <div style="text-align:right; margin-top:15px;">
                <button id="btnCloseResidualRiskModalFooter" class="primary-button">Fertig</button>
            </div>
        </div>
    </div>

    <div id="versionControlModal" class="modal" style="display:none;">
        <div class="modal-content large-content"><span class="close-button" id="closeVersionControlModal">&times;</span><h2>Versionen</h2><table class="history-table"><thead><tr><th>Ver.</th><th>Datum</th><th>Autor</th><th>Kommentar</th></tr></thead><tbody id="historyTableBody"></tbody></table><div style="margin-top:10px;"><button class="primary-button" onclick="openVersionCommentModal()">Neue Version</button></div></div>
    </div>
    <div id="versionCommentModal" class="modal" style="display:none;">
        <div class="modal-content"><span class="close-button" id="closeVersionCommentModal">&times;</span><h2>Neue Version</h2><form id="versionCommentForm"><textarea id="inputVersionComment" required></textarea><button type="submit" class="primary-button">Speichern</button></form></div>
    </div>
    
    <div id="confirmationModal" class="modal" style="display:none;">
        <div class="modal-content small">
            <span class="close-button" id="closeConfirmationModal">&times;</span>
            <h2 id="confirmationTitle">Bestätigung</h2>
            <p id="confirmationMessage">Sicher?</p>
            <div style="text-align:right;">
                <button id="btnCancelConfirmation" class="action-button">Abbrechen</button> 
                <button id="btnConfirmAction" class="primary-button">OK</button>
            </div>
        </div>
    </div>
    
    <div id="toastContainer"></div>

    <script src="globals.js"></script>
    <script src="utils.js"></script>
    <script src="analysis_core.js"></script>
    <script src="assets.js"></script>
    <script src="damage_scenarios.js"></script>
    <script src="impact_matrix.js"></script>
    <script src="security_goals.js"></script>
    <script src="risk_analysis.js"></script>
    <script src="attack_tree_structure.js"></script>
    <script src="attack_tree_ui.js"></script>
    <script src="attack_tree_calc.js"></script>
    <script src="dot_export.js"></script>
    <script src="versioning.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="report_export.js?v=26"></script>
    <script src="residual_risk_data.js"></script>
    <script src="residual_risk_ui.js"></script>
    <!-- <script src="residual_risk_structure.js?v=27"></script>
    <script src="residual_risk_calc.js?v=27"></script>
    <script src="residual_risk_pdf.js?v=27"></script>
    <script src="residual_risk_ui.js?v=27"></script> -->
    <script src="init.js"></script>
</body>
</html>